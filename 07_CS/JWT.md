# JWT - Json Web Token

***참고: [JWT - Json Web Token | DaleSeo](https://www.daleseo.com/jwt/)***

#### 목차
- [JWT란](#JWT란)
- [JWT 구조](#JWT-구조)
- [JWT를 통한 인증/인가](#JWT를-통한-인증/인가)
- [JWT의 장점](#JWT의-장점)
- [JWT의 한계](#JWT의-한계)
- [JWT 사용 시 주의 사항](#JWT-사용-시-주의-사항)

<br>


## JWT란
- 주로 사용자의 인증(authentication) 또는 인간(authorization) 정보를 서버와 클라이언트 간에 안전하게 주고 받기 위해서 사용
- 보통 `Authorization` HTTP 헤더를 `Bearer <토큰>`의 형태로 설정하여 클라이언트에서 서버로 전송되고
  - -> 서버에서는 토큰에 포함되어 있는 서명(signature) 정보를 통해서 위변조 여부를 빠르게 검증할 수 있음
- JWT 토큰은 Base64로 인코딩이 되어 있어서 육안으로 보면 `eyJ`로 시작하는 아주 긴 문자열
  - [온라인 디버거](https://jwt.io/)를 통해 실제로 저장되어 있는 내용을 JSON 형태로 디코딩하여 확인 가능


<br/>

>JWT는 JSON Web Token(JSON 웹 토큰)의 약자로, `선택적 서명` 및 `선택적 암호화`를 사용하여 데이터를 만들기 위한 인터넷 표준이다.
> - 페이로드는 몇몇 `클레임(claim)` 표명(assert)을 처리하는 JSON을 보관하고 있다.
> - 토큰은 `비공개 시크릿 키` 또는 `공개/비공개 키`를 사용하여 서명된다.
> - 서버는 "관리자로 로그인 됨"이라는 클레임이 있는 토큰을 생성하여 이를 클라이언트에 제공 -> 클라이언트는 해당 토큰을 사용하여 관리자로 로그인됨을 증명
> - ***참고: [JSON 웹 토큰 | 위키백과](https://ko.wikipedia.org/wiki/JSON_%EC%9B%B9_%ED%86%A0%ED%81%B0)***


## JWT 구조
- 헤더(header)와 페이로드(payload), 서명(signature) 세 부분으로 이루어지며, 각 구역이 `.` 기호로 구분됨
``` 
  <헤더>.<페이로드>.<서명>
```

  - 헤더(header): 토큰의 유형과 서명 알고르짐에 명시
  - 페이로드(payload): 소위 claim이라고 불리는 사용자의 인증/인가 정보가 담김
  - 서명(signature): 헤더와 페이로드가 비밀키로 서명되어 저장
- JWT 토큰은 네트워크로 전송되어야 하기 때문에 공간을 적게 차지하는 것이 유리
  - -> JSON 형식으로 데이터를 저장할 때 키(key)를 3글자로 줄이는 관행이 있음
- 전형적인 JWT 토큰의 디코딩 결과
  ```json
  // 헤더
  {
    "alg": "HS256",
    "typ": "JWT"
  }
  ```
  
  ```json
  // 페이로드
  {
    "sub": "1234567890",
    "lat": 1516239022
  }
  ```

- JWT에서 자주 사용되는 JSON 키 이름
  - `sub`키: 인증 주체(subject)
  - `iss`키: 토큰 발급처
  - `typ`키: 토의 유형(type)
  - `alg`키: 서명 알고리즘(algorithm)
  - `iat`키: 발급 시각(issued at)
  - `exp`키: 만료 시작(expiration time)
  - `aud`키: 클라이언트(audience)

<br>

 ## JWT를 통한 인증/인가
 JWT는 실무에서 `OAuth`나 `OIDC 프로토콜`과 함께 API의 인증이나 인가를 위해서 주료 사용됨
  > - OAuth: Open Authorization의 약자로, 인터넷 사용자들이 비밀번호를 제공하지 않고 다른 웹사이트 상의 자신들의 정보에 대해 웹사이트나 애플리케이션의 접근 권한을 부여할 수 있는 공통적인 수단으로서 사용되는 접근 위임을 위한 개방형 표준
  >   - ex) 아마존, 구글, 페이스북, 마이크로소프트, 트위터, 깃허브, 카카오톡 등
  > - ***참고: [OAuth | 위키백과](https://ko.wikipedia.org/wiki/OAuth)***
 
 - 클라이언트가 어떤 서비스의 인가 서버를 통해 로그인에 성공하면, JWT 토큰을 획득
   - -> 클라이언트는 해당 서비스의 API를 호출할 때, JWT 토큰을 보내서 원하는 자원에 접근하거나 허용된 작업을 수행 할 수 있음

>OAuth나 OIDC에 대해 아래 관련 포스팅을 참고(DaleSeo님 블로그)
> - [OAuth 2.0으로 구글 API 호출하기](https://www.daleseo.com/google-oauth/)
> - [구글 OpenID Connect 사용법](https://www.daleseo.com/google-oidc/)

<br>

## JWT의 장점
- JWT 등장 이전, 사용자 인증 구현을 위해 쿠키와 세션을 사용할 때 한계점:
  - 서버 단에 로그인한 모든 사용자의 세션을 DB나 캐시(cache)에 저장해놓고 쿠키로 넘어온 세션 ID로 사용자 데이터를 매번 조회해야 함
- 반면에 JWT는 **확장성** 확보 가능:
  - JWT는 토큰 자체에 사용자의 정보가 저장되어 있기 때문에, 서버 입장에서 토큰을 검증만 해주면 됨
  - 사용자가 늘어나더라도, 사용자 인증을 위해 추가로 투자해야하는 인프라 비용을 크게 절감 가능
  - 쿠키를 사용하지 않으므로, CORS 문제에서 자유로움

 > 쿠키나 세션에 대한 포스팅(DaleSeo님 블로그)
 > - [쿠키 1부: HTTP로 설명하는 쿠키(cookie)](https://www.daleseo.com/http-cookies/)
 > - [쿠키 2부: 세션은 쿠키가 필요해~](https://www.daleseo.com/http-session/)


<br>

## JWT의 한계
그럼에도, 어느 정도 규모가 있는 서비스에서 사용자 인증 용도로 사용하기에는 부족한 경우가 있음
- ex) 현재 로그인된 사용자의 모든 디바이스를 나열해주거나, 특정 디바이스에서 로그아웃을 허용하는 기능을 구현하려면 서버 단에 사용자 세션을 저장하지 않고는 어려움

<br>

## JWT 사용 시 주의 사항
- 서며이 되어 있는 JWT 토큰 서버에서만 유효성을 검증할 수 있지만, 그 안에 저장된 데이터는 누구나 쉽게 열람 가능
  - 보안 문제 이슈
- 가급적 JWT 토큰에는 **사용자를 식별할 수 있는 아이디 정도**만 저장하는 것이 좋음
  - 사용자에 대한 추가 정보는, 서버에서 사용자 DB를 조회하는 것이 안전
- 불가피한 이유로 민감한 사용자 정보를 저장해야 한다면, 반드시 ***암호화***  필요
  - JWT 토큰을 디코딩한 후에도 알아볼 수 없도록

<br>

→ [자바스크립트로 JWT 토큰을 발급하고 검증하기](https://www.daleseo.com/js-jwt/)

